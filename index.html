<!DOCTYPE html>
<html lang="fr">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GeoPhoto Editor - Modifier la g√©olocalisation EXIF</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

  <!-- Link to the external CSS file -->
  <link rel="stylesheet" href="style.css">
  
  <!-- Link to manifest -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#4a90e2">

<script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('./sw.js')
        .then(reg => console.log('Service Worker enregistr√© !', reg))
        .catch(err => console.log('√âchec du Service Worker', err));
    });
  }
</script>
  
</head>

<body>
  <div class="container">
    <header style="position: relative;">
      <div class="header-titles">
        <h1>GeoPhoto Editor</h1>
        <p class="subtitle" style="max-width: 800px;">Modifiez facilement les EXIFs (GPS, date) de vos images JPEG</p>
      </div>
      <button onclick="openHelp()" class="btn-help" aria-label="Ouvrir le manuel d'aide" title="Aide et Instructions">
        <span style="font-size: 1.4rem; font-weight: 800; font-family: sans-serif;">?</span>
      </button>
    </header>

    <main class="main-card">
      <div class="upload-area" id="dropZone" tabindex="0" role="button"
        aria-label="Zone de d√©p√¥t ou de s√©lection d'image">
        <div class="upload-icon">
          <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
            stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
            <polyline points="17 8 12 3 7 8"></polyline>
            <line x1="12" y1="3" x2="12" y2="15"></line>
          </svg>
        </div>
        <div>
          <p class="upload-text">Glissez-d√©posez une image ici</p>
          <p class="upload-subtext">ou cliquez pour choisir un fichier JPEG</p>
        </div>
        <input type="file" id="imageInput" accept="image/jpeg" style="display:none;" aria-hidden="true">
      </div>

      <div id="error-message" class="alert error" style="display: none;" role="alert">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
          stroke-linecap="round" stroke-linejoin="round" style="flex-shrink: 0;">
          <circle cx="12" cy="12" r="10"></circle>
          <line x1="12" y1="8" x2="12" y2="12"></line>
          <line x1="12" y1="16" x2="12.01" y2="16"></line>
        </svg>
        <span id="error-text">L‚Äôimage ne contient pas de coordonn√©es GPS. Cliquez sur la carte pour en d√©finir.</span>
      </div>

      <div class="content-grid" id="contentSection" style="display: none;">
        <!-- Ligne du haut : Photo + EXIF -->
        <div class="layout-row row-top">
          <div class="image-wrapper">
            <div class="image-container">
              <img id="preview" src="" alt="Aper√ßu de l'image s√©lectionn√©e">
            </div>
            <div class="filename-edit">
              <input type="text" id="filenameInput" aria-label="Nom du fichier" placeholder="Nom du fichier">
              <span class="extension">.jpg</span>
            </div>
          </div>

          <!-- New EXIF & Date/Time Section -->
          <div class="exif-card" id="exifSection" style="display: none;">
            <div class="section-header">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="12" y1="16" x2="12" y2="12"></line>
                <line x1="12" y1="8" x2="12.01" y2="8"></line>
              </svg>
              <h3>Informations Photo (EXIF)</h3>
            </div>

            <div class="exif-grid" id="exifDataGrid">
              <!-- EXIF data will be injected here via JS -->
            </div>

            <div class="input-group" style="margin-top: 1rem;">
              <label for="datetimeBtn">Date et Heure de Prise de Vue</label>
              <div class="input-wrapper">
                <input type="datetime-local" id="datetimeInput" step="1">
              </div>
            </div>
          </div>
        </div>

        <!-- Ligne du bas : Carte + Modifications G√©oloc -->
        <div class="layout-row row-bottom">
          <div class="map-container" aria-label="Carte interactive pour s√©lectionner la position">
            <div id="map"></div>
          </div>

          <div class="coords-card">
            <div class="input-group">
              <label for="lat">Latitude (¬∞)</label>
              <div class="input-wrapper">
                <input type="number" step="any" id="lat" readonly placeholder="Cliquez sur la carte"
                  aria-label="Latitude">
              </div>
            </div>
            <div class="input-group">
              <label for="lng">Longitude (¬∞)</label>
              <div class="input-wrapper">
                <input type="number" step="any" id="lng" readonly placeholder="Cliquez sur la carte"
                  aria-label="Longitude">
              </div>
            </div>

            <div class="input-group" style="margin-top: 0.5rem;">
              <label for="searchLocation">Aller √† une ville / Code Postal</label>
              <div class="input-wrapper" style="display: flex; gap: 0.5rem;">
                <input type="text" id="searchLocation" placeholder="Ex: Dijon, 21000" aria-label="Rechercher un lieu">
                <button class="btn-secondary" onclick="searchCity()" type="button"
                  style="padding: 0.5rem 1rem; width: auto;" title="Rechercher sur la carte">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="11" cy="11" r="8"></circle>
                    <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                  </svg>
                </button>
              </div>
            </div>

            <div class="actions" style="margin-top: 1.5rem;">
              <button class="btn-secondary" onclick="getCurrentLocation()" type="button">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                  stroke-linecap="round" stroke-linejoin="round">
                  <polygon points="3 11 22 2 13 21 11 13 3 11"></polygon>
                </svg>
                Utiliser ma position pr√©cise
              </button>
              <button class="btn-primary" onclick="updateGPS()" type="button">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                  stroke-linecap="round" stroke-linejoin="round">
                  <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                  <polyline points="17 21 17 13 7 13 7 21"></polyline>
                  <polyline points="7 3 7 8 15 8"></polyline>
                </svg>
                Mettre √† jour & T√©l√©charger
              </button>

              <div class="separator"
                style="display: flex; align-items: center; margin: 0.5rem 0; color: var(--text-muted); font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.1em; font-weight: 600;">
                <span style="flex: 1; height: 1px; background: var(--border);"></span>
                <span style="margin: 0 10px;">Confidentialit√©</span>
                <span style="flex: 1; height: 1px; background: var(--border);"></span>
              </div>

              <button class="btn-danger" onclick="removeGPS()" type="button"
                title="Supprimer toute donn√©e de g√©olocalisation de l'image pour la s√©curiser">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                  stroke-linecap="round" stroke-linejoin="round">
                  <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
                  <line x1="9" y1="12" x2="15" y2="12"></line>
                </svg>
                S√©curiser (Supprimer GPS)
              </button>
            </div>
          </div>
        </div>
      </div>
    </main>

    <footer class="app-footer">
      <p>Version 1.0 - 24 F√©vrier 2026</p>
      <p>D√©velopp√© par <a href="mailto:yves.balestra@gmail.com">yves.balestra@gmail.com</a></p>
    </footer>
  </div>

  <!-- Help Modal Overlay -->
  <div id="helpModal" class="modal-overlay" style="display: none;">
    <div class="modal-content">
      <button class="modal-close" onclick="closeHelp()" aria-label="Fermer l'aide">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
          stroke-linecap="round" stroke-linejoin="round">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>

      <h2>Manuel d'Utilisation</h2>
      <p class="modal-subtitle">Comment utiliser GeoPhoto Editor üìçüì∑</p>

      <div class="modal-body">
        <section class="help-section">
          <h3>1. Choisir une image</h3>
          <ul>
            <li>Glissez et d√©posez une photo au format <strong>JPEG</strong> dans la zone en pointill√©s.</li>
            <li>Si l'image contient d√©j√† des coordonn√©es GPS, la carte sera automatiquement centr√©e dessus.</li>
          </ul>
        </section>

        <section class="help-section">
          <h3>2. Modifier les Donn√©es (Date & GPS)</h3>
          <ul>
            <li><strong>Date et Heure :</strong> Le panneau de gauche affiche les r√©glages de votre appareil photo. Vous
              pouvez librement modifier la "Date de prise de vue" via le s√©lecteur.</li>
            <li><strong>G√©olocalisation manuelle :</strong> Cliquez n'importe o√π sur la carte pour d√©finir un nouveau
              rep√®re GPS.</li>
            <li><strong>Recherche :</strong> Tapez le nom d'une ville (en France) ou un code postal dans la barre de
              recherche et appuyez sur Entr√©e.</li>
            <li><strong>Bouton "Utiliser ma position pr√©cise" :</strong> R√©cup√®re les coordonn√©es exactes d√©tect√©es par
              votre appareil informatique (si autoris√©).</li>
          </ul>
        </section>

        <section class="help-section">
          <h3>3. Exporter & S√©curiser</h3>
          <ul>
            <li><strong>Modifier le nom :</strong> Cliquez sur le texte sous la photo pour donner un nom personnalis√© √†
              votre fichier final export√©.</li>
            <li><strong style="color: var(--primary);">Mettre √† jour & T√©l√©charger :</strong> Enregistre vos
              modifications (Date et GPS) et t√©l√©charge la nouvelle image JPEG sur votre machine.</li>
            <li><strong style="color: var(--error-text);">S√©curiser (Supprimer GPS) :</strong> Ce bouton rouge efface
              <em>toutes</em> les traces g√©ographiques de la photo. Id√©al si vous souhaitez la publier anonymement sur
              Internet. (T√©l√©charge une copie portant la mention "_sans_gps").
            </li>
          </ul>
        </section>

        <div class="help-privacy-note">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
            stroke-linecap="round" stroke-linejoin="round" style="flex-shrink: 0; color: #10b981;">
            <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
            <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
          </svg>
          <p><strong>Z√©ro transfert de donn√©es :</strong> Vos photos ne quittent jamais votre ordinateur. Tout r√©seau ou
            calcul est effectu√© localement par votre navigateur !</p>
        </div>
      </div>
    </div>
  </div>

  <!-- External Libraries -->
  <script src="https://unpkg.com/piexifjs"></script>
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <!-- Link to the external JavaScript file -->
  <script src="script.js"></script>
</body>

</html>